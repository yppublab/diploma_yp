# Forward Suricata fast.log via rsyslog imfile
module(load="imfile")

input(type="imfile"
      File="/var/log/suricata/eve.json"
      Tag="suricata-eve"
      Facility="local5"
      Severity="info")

input(
  type="imfile"
  File="/var/log/suricata/fast.log"
  Tag="suricata:"
  Facility="local5"
  Severity="alert"
  PersistStateInterval="100"
)

# Drop Suricata JSON parsing errors before forwarding
if ($programname == "suricata" and $msg contains "jsonerror") then stop
if ($programname == "suricata" and $msg contains "jsonDuplicate") then stop

# Forward selected facilities to Wazuh manager
if ($syslogfacility-text == "local5" or $syslogfacility-text == "auth" or $syslogfacility-text == "authpriv" or $syslogfacility-text == "syslog") then {
  action(
    type="omfwd"
    target="srv_wazuh_manager"
    port="514"
    protocol="tcp"
    template="RSYSLOG_SyslogProtocol23Format"
    queue.type="linkedList"
    queue.filename="wazuh_fwd"
    action.resumeRetryCount="-1"
  )
  stop
}
