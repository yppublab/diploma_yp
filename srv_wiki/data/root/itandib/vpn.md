# VPN и WireGuard Portal

Ниже — краткая инструкция, как получить доступ к WireGuard Portal, забрать конфиг и что делать, если что‑то пошло не так.

## Доступ в портал
- Откройте `http://srv_wg_portal.local.host:8888/` (или URL портала в вашей сети).
- Введите учетные данные LDAP (логин и пароль доменной учетной записи).
- Если доступ не выдаётся — убедитесь, что ваша учетная запись в нужной группе доступа к VPN.
![image.png](/assets/FX8ypPGDg/image-1.png)

## Получение клиентского конфига
### Самостоятельное получение
Если у вас уже есть учетная запись
- После входа выберите свой профиль.
- Скачайте конфигурацию `wg0.conf` для нужного устройства (Desktop/Mobile).
- Сохраните ключи в безопасном месте; не публикуйте QR/конфиг.

### Создание выполняет администратор:
- Зайдите на портал под учетной записью администратора.
- В разделе Users проверьте наличие пользователя (централизованные пользователи создаются автоматически). При отсутствии нужного пользователя пользователя необходимо создать либо в [LDAP](http://srv_ldap_mgmt.local.host/), либо прямо на WireGuard Portal (локальный пользователь).
- Для создания локального пользователя нажмите на кнопку создания пользователя в разделе Users, укажите идентификатор и заполните все остальные необходимые поля.
- Перейдите в раздел Interfaces и нажмите кнопку создания новой конфигурации (peer) ![image.png](/assets/FX8ypPGDg/image-3.png)
- В окне `Create Peer`:
  - в поле Linked User указать имя пользователя из Users (LDAP или локального), которому необходимо создать конфигурацию.
  - в поле `IP Addresses` указывается IP-адрес клиента, который будет ему назначен в криптографическом туннеле к Wireguard Portal (обычно оставляем по умолчанию следующий свободный IP по порядку);
  - в поле `Allowed IP Addresse`s укажите подсети, которые должны быть доступны пользователю через туннель (внутренние подсети компании) -- придерживайтесь принципа минимума полномочий;
  - в поле `DNS Server` укажите адрес корпоративного DNS-сервера;
  - в поле `Expiry date` укажите дату истекания срока действия конфигурации, после которой клиент не сможет подключаться (в соответствии с заявкой). Нажмите кнопку `Save`.
  - Скачайте и передайте клиенту его новую конфигурацию для подключения к WireGuard Portal.
![image.png](/assets/FX8ypPGDg/image-2.png)

## Подключение клиента
- Установите WireGuard на устройстве.
- Импортируйте `wg0.conf` или отсканируйте QR.
- Включите туннель. Проверьте `wg show` или статус приложения — интерфейс должен подняться без ошибок.

## Сетевые настройки (AllowedIPs)
- По умолчанию в конфиге указываются адреса VPN-подсети (например, `10.11.12.0/24`).
- Если нужен доступ к внутренним сетям (192.168.x.x), добавьте эти сети в `AllowedIPs` или попросите администратора выдать расширенный профиль.
- Не указывайте чрезмерно широкие маски без необходимости — это может перенаправлять лишний трафик.

## LDAP аутентификация
- Портал использует LDAP для входа. Если пароль не принимается — проверьте, что пароль актуален и учётка не заблокирована.
- Синхронизация базы пользователей с LDAP происходит **раз в пять минут**.
- Группа администраторов портала задаётся DN группы (например, `cn=SG-VPN-ADMINS,...`). Для обычных пользователей достаточно членства в пользовательской группе VPN.

## Если не подключается
- Проверьте локально: `ping` адрес шлюза VPN (например, 10.11.12.1) и `wg show` на наличие Handshake.
- Убедитесь, что на стороне сервера включён NAT/маршрутизация с `wg0` на `eth0`, и что ваши `AllowedIPs` не конфликтуют с локальными маршрутами.
- Посмотрите логи портала WireGuard.

## Прекращение доступа
- Не забываем всегда отключать доступ работников, которые решили продолжить свой карьерный путь в другой компании. Надеяться только на LDAP нельзя, тем более что там на текущий момент нет возможности отключить учеткку.
- Для прекращения доступа надо зайти в `User Administration`, щелкнуть на кнопку редактирования пользователя и поставить флажок `Disabled`. Это же можно использовать, если по каким-то причинам пользователя надо срочно отключить от корпоративных сервисов.
![image.png](/assets/FX8ypPGDg/image.png)

## Контакты
- По вопросам доступа/групп — к админам домена/LDAP.
- По сетевым маршрутам и политикам — к команде сети/безопасности.
