# Интеграции с Wazuh: что и как подключать

Wazuh умеет собирать и обрабатывать события из множества источников, обогащать их внешними фидами и слать нотификации/тикеты. Ниже — основные типы интеграций и где их настраивать.

## Системные и сетевые логи
- **Syslog/rsyslog**: приём внешних логов на порты 514/UDP или TCP, прописывается в `ossec.conf` в блоке `<remote>`/`<localfile>` (тип `syslog`). На источниках — forwarding через syslog.
- **Локальные файлы/журналы** (на хостах с агентами): блок `<localfile>` — любой путь к файлу (auth.log, nginx, app.log). Wazuh будет парсить по декодерам/правилам.
- **Windows**: через агент (Security, System, Application) + аудит PowerShell/Defender/Forwarded Events.
- **Сетевые IDS/IPS**: Suricata/Zeek/Snort — либо syslog-выгрузка, либо чтение логов файловым логколлектором с готовыми декодерами/правилами.

## Инвентаризация и уязвимости
- **Syscollector**: встроенный модуль агента — собирает пакеты, софт, сеть, аппаратные данные.
- **Vulnerability Detector**: сравнивает версии пакетов с базами CVE (NVD, vendor feeds). Включается на менеджере; нужны обновления фидов и актуальные данные syscollector.

## Обогащение и Threat Intelligence
- **OTX (AlienVault)**: укажите API-ключ OTX в файле конфигурации `ossec.conf` и будете получать данные IOC (feed) для использования в корреляции.
- **VirusTotal**: интеграция через `integrations/vt` — проверки хэшей/URL, вызывается из правил.
- **Custom IOC feed**: можно подключать свои списки IP/доменов через активные правила/lookup-файлы.

## Нотификации и тикеты
Wazuh имеет несколько вариантов оповещений
- **Почта**: привычные сообщения электронной почты (редактируется блок `<email_notification>` + smtp в `ossec.conf`).
- **Webhooks/Slack/Teams**: скрипты в `/var/ossec/integrations/` (slack, ms-teams) и свой `custom`. Правила вызывают интеграцию по `integration = "slack"` и т.п.
- **Jira/ServiceNow**: готовые скрипты интеграций (ticket creation) или собственный webhook в `custom-integration`.

## Активный ответ (Active Response)
- Скрипты расположены в `/var/ossec/active-response/bin/`. Позволяет настроить реагирование на события прямо на хосте, например, блокировка IP, отключение пользователя. Правила запускают действие по условию. Можно добавлять свои скрипты и параметры.

## Где править
- Менеджер: `/var/ossec/etc/ossec.conf` — входные источники, модули, интеграции.
- Декодеры/правила: `/var/ossec/ruleset` или `etc/decoders/local_decoder.xml`, `etc/rules/local_rules.xml`.
- Интеграции: `/var/ossec/integrations/` (скрипты и конфиг), Active Response: `/var/ossec/active-response/bin/`.
- Дашборд/SSO: `/usr/share/wazuh-dashboard/config/wazuh.yml`, `opensearch_dashboards.yml`.

## Мини-шпаргалка по подключению нового источника
1) Определить формат (syslog/file/API).  
2) Добавить блок `<localfile>` в /etc/rules/local_rules.xml, что позволит указать агенту какой журнал читать и передавать данные центральному серверу. Поддерживаются в том числе стандартные журналы syslog.
3) Если журналы имеют специфичую структуру Wazuh позволяет создать свой декодер для журнала или правило его обработки.  
4) Протестировать событие (катнуть тест-лог, проверить алерт) в разделе  Server Management -> Ruleset Test 5) Настроить нотификацию/active response при необходимости.
